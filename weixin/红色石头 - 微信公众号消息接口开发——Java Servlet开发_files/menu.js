var html="";function showTime(){setInterval("document.getElementById('currentTimeDiv').innerHTML = new Date().toLocaleString()+' 星期'+'日一二三四五六'.charAt(new Date().getDay());",1000)}$(function(){$("#web_loading div").animate({width:"100%"},800,function(){setTimeout(function(){$("#web_loading div").fadeOut(500)})})});function sendArticleMsg(id){var sendButton=$("form div[.form_settings] p input[name='msg_submitted']");sendButton.attr("disabled","disabled");sendButton.attr("value","WAIT...");sendButton=$("form div[.form_settings] p input:disabled");var name=$("form div[.form_settings] p input[name='name']").val();var website=$("form div[.form_settings] p input[name='website']").val();var email=$("form div[.form_settings] p input[name='email']").val();var content=$("form div[.form_settings] p textarea[name='content']").val();var parentId=$("form div[.form_settings] input[name='parentMsgId']").val();if(name==null||trim(name)==""){toast("Nick Name 不能为空,亲~");sendButton.removeAttr("disabled");sendButton.attr("value","SEND");return}else{if(name.length>20){toast("Nick Name短一点会死啊~");sendButton.removeAttr("disabled");sendButton.attr("value","SEND");return}}if(email==null||trim(email)==""||(!isEmail(email))){toast("如果不填正确的邮箱,我怕我联系不上你~");sendButton.removeAttr("disabled");sendButton.attr("value","SEND");return}if(email.length>40){toast("你注册这么长的邮箱搞毛线啊~");sendButton.removeAttr("disabled");sendButton.attr("value","SEND");return}if(!(website==null||trim(website)=="")){if(!(website.indexOf("http://")==0||website.indexOf("https://")==0)){toast("网站最好以http://或https://开头，不然别人访问不到滴~");sendButton.removeAttr("disabled");sendButton.attr("value","SEND");return}if(website.length>40){toast("这么长的域名应该是不要钱的吧~");sendButton.removeAttr("disabled");sendButton.attr("value","SEND");return}}if(name.indexOf("%")>=0||email.indexOf("%")>=0||website.indexOf("%")>=0){toast("昵称、邮箱、网址不允许有%字符，请检查~");sendButton.removeAttr("disabled");sendButton.attr("value","SEND");return}if(content==null||trim(content)==""){toast("不说话者格杀勿论！");sendButton.removeAttr("disabled");sendButton.attr("value","SEND");return}else{if(content.length>400){toast("精简的言语更能体现你的智慧！");sendButton.removeAttr("disabled");sendButton.attr("value","SEND");return}}if(content.charAt(0)!="@"){parentId=0}var articleId=id;saveUserInfo2Cookie(name,email,website);$.ajax({url:"./action/articleMsg/addArticleMsg.php",type:"POST",data:{articleId:articleId,content:content,website:website,email:email,name:name,parentId:parentId},dataType:($.browser.msie)?"text":"xml",success:function(xmlData){var xml;if(typeof xmlData=="string"){xml=new ActiveXObject("Microsoft.XMLDOM");xml.async=false;xml.loadXML(xmlData)}else{xml=xmlData}var result=$(xml).find("result").text();if(result=="0"){$("form div[.form_settings] p textarea[name='content']").val("");var msgLength=$(".aMsgBlock").length;var currTime=getDate();if(msgLength>0){var msgHtml='<div class="aMsgBlock">'+'<div style="float:left;"> FLOOR '+(msgLength+1)+'   &nbsp;&nbsp;&nbsp; [<a href="'+website+'" target="_blank"> '+name+" </a>] said "+"</div>"+'<div style="float:right;"> at <a>'+currTime+"</a></div><p />"+"<p>"+content+"</p>"+"</div>";$(".aMsgBlock:last").after(msgHtml)}else{var msgHtml='<div class="aMsgBlock">'+'<div style="float:left;"> FLOOR 1   &nbsp;&nbsp;&nbsp; [<a href="'+website+'" target="_blank"> '+name+" </a>] said "+"</div>"+'<div style="float:right;"> at <a>'+currTime+"</a></div><p />"+"<p>"+content+"</p>"+"</div>";$(".seperator:first").after(msgHtml)}}else{if(result=="-1"){toast("fail")}else{if(parseInt(result)>0){toast("歇会吧，孩子！再过"+result+"秒你才能留言~")}}}sendButton=$("form div[.form_settings] p input:disabled");sendButton.removeAttr("disabled");sendButton.attr("value","SEND")},error:function(){toast("error");sendButton=$("form div[.form_settings] p input:disabled");sendButton.removeAttr("disabled");sendButton.attr("value","SEND")}})}function to_reply(msgId,name){var contentEle=$("form div[.form_settings] p textarea[name='content']");$("form div[.form_settings] input[name='parentMsgId']").val(msgId);contentEle.focus();contentEle.val("@"+name+": ");return false}function getDate(){var d=new Date();var vYear=d.getFullYear();var vMon=d.getMonth()+1;var vDay=d.getDate();var h=d.getHours();var m=d.getMinutes();var se=d.getSeconds();s=vYear+"-"+(vMon<10?"0"+vMon:vMon)+"-"+(vDay<10?"0"+vDay:vDay)+" "+(h<10?"0"+h:h)+":"+(m<10?"0"+m:m)+":"+(se<10?"0"+se:se);return s}function trim(str){return str.replace(/(^\s*)|(\s*$)/g,"")}function toast(text){noty({"text":text,"theme":"noty_theme_facebook","layout":"center","type":"alert","animateOpen":{"height":"toggle"},"animateClose":{"height":"toggle"},"speed":500,"timeout":3000,"closeButton":true,"closeOnSelfClick":true,"closeOnSelfOver":false,"modal":true})}function isEmail(email){return email.match(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/)}function shake(selector,margin){/*$(selector).hover(function(){$(this).animate({marginLeft:margin*-1,marginRight:margin},100).animate({marginLeft:-1*margin/2,marginRight:margin/2},100).animate({marginLeft:margin*-1,marginRight:margin},100)},function(){$(this).stop(true).animate({marginLeft:0,marginRight:0},100)})*/};